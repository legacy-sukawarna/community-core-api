generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id              String            @id @default(uuid())
  email           String            @unique
  name            String
  role            Role              @default(MEMBER)
  congregation_id String?
  phone           String            @db.VarChar(15)
  created_at      DateTime          @default(now())
  updated_at      DateTime          @updatedAt
  gender          Gender?
  group_id        String?
  group           Group?            @relation("Mentees", fields: [group_id], references: [id])
  EventAttendance EventAttendance[]
  mentoredGroups  Group[]           @relation("MentorGroups")
}

model Group {
  id                 String              @id @default(uuid())
  name               String              @unique
  mentor_id          String? // Changed from required to optional
  mentor             User?               @relation("MentorGroups", fields: [mentor_id], references: [id])
  created_at         DateTime            @default(now())
  updated_at         DateTime            @updatedAt
  connect_attendance ConnectAttendance[]
  mentees            User[]              @relation("Mentees")

  @@index([mentor_id])
}

model Event {
  id              String            @id @default(uuid())
  name            String
  date            DateTime
  created_at      DateTime          @default(now())
  updated_at      DateTime          @updatedAt
  EventAttendance EventAttendance[]
}

model ConnectAttendance {
  id         String   @id @default(uuid())
  group_id   String
  notes      String?
  photo_url  String?
  date       DateTime @db.Date
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt
  group      Group    @relation(fields: [group_id], references: [id])

  @@index([date]) // Index for filtering by date
  @@index([group_id])
}

model EventAttendance {
  id          String   @id @default(uuid())
  user_id     String
  event_id    String
  attended_at DateTime @default(now()) // Optional: Timestamp for attendance
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt
  user        User     @relation(fields: [user_id], references: [id])
  event       Event    @relation(fields: [event_id], references: [id])

  @@index([user_id, event_id]) // For efficient lookups by user and event
}

enum Role {
  ADMIN
  MENTOR
  MEMBER
}

enum Gender {
  MALE
  FEMALE
}
